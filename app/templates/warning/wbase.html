{% extends "bootstrap/base.html" %}
{#这里 {% extends %} 标记是关键，它告诉模板引擎这个模板“扩展”了另一个模板，
当模板系统评估这个模板时会先找到父模板。这个扩展标记必须是模板中的第一个标记。
如果要使用父模板中的块内容，请使用 {{ super() }} 。#}
{% block doc -%}
<!DOCTYPE html>
<html {% block html_attribs %}lang="zh-CN"{% endblock html_attribs %}>
{%- block html %}
<head {% block head_attribs %}{% endblock head_attribs %}>
    {% block head %}
    <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>OneKeeper</title>

		<!-- Bootstrap Core CSS -->
		<link href="{{ url_for('static', filename='src/vendor/bootstrap/css/bootstrap.min.css') }}" rel="stylesheet">

		<!-- MetisMenu CSS -->
		<link href="{{ url_for('static', filename='src/vendor/metisMenu/metisMenu.min.css') }}" rel="stylesheet">

		<!-- DataTables CSS -->
	    <link href="{{ url_for('static', filename='src/vendor/datatables-plugins/dataTables.bootstrap.css') }}" rel="stylesheet">

	    <!-- DataTables Responsive CSS -->
	    <link href="{{ url_for('static', filename='src/vendor/datatables-responsive/dataTables.responsive.css') }}" rel="stylesheet">

		<!-- Custom CSS -->
		<link href="{{ url_for('static', filename='src/css/main.css') }}" rel="stylesheet">

		<!-- Extend CSS -->
		<link href="{{ url_for('static', filename='src/css/extend.css') }}" rel="stylesheet">

		<!-- Custom Fonts -->
		<link href="{{ url_for('static', filename='src/vendor/font-awesome/css/font-awesome.min.css') }}" rel="stylesheet" type="text/css">

		<!-- favicon -->
        <link rel="shortcut icon" href="{{ url_for('static', filename='src/images/favicon.ico') }}">
    {%- endblock head %}
</head>

<body {% block body_attribs %}{% endblock body_attribs %}>
    {% block body -%}
        {% block wrapper -%}
            <div id="wrapper">
            {% block navbar -%}
			<!-- Navigation -->
			<nav class="navbar navbar-default navbar-static-top navbar-mc" role="navigation">
				<div class="navbar-header">
				</div>
				<div class="menu-top">
					 <ul>
                                {% if current_user.is_authenticated %}
                                <li><a href="{{ url_for('main.mon_server') }}" target="view_window">监控管理</a></li>
                                <li><a href="{{ url_for('main.alarm_monitoring') }}">告警分析</a></li>
                                <li><a href="{{ url_for('main.system_health') }}">数据库健康分析</a></li>
                                <li><a href="{{ url_for('toolbox.index') }}">运维工具箱</a></li>
                                <li><a href="{{ url_for('library.index') }}">知识库</a></li>
                                <li><a href="{{ url_for('auth.index') }}">系统管理</a></li>
                                <li class="dropdown navbar-right">
                                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                    <i class="fa fa-user fa-fw"></i> <i class="fa fa-caret-down"></i>
                                </a>
                                <ul class="dropdown-menu dropdown-user">
                                    <li><a href="{{ url_for('auth.change_password') }}"><i class="fa fa-edit fa-fw"></i> 修改密码</a>
                                    </li>
                                    <li><a href="{{ url_for('auth.logout') }}"><i class="fa fa-sign-out fa-fw"></i> 退出登录</a>
                                    </li>
                                </ul>
                                <!-- /.dropdown-user -->
                                </li>
                                {% else %}
                                <li><a href="{{ url_for('auth.login') }}">账号登录</a></li>
                                {% endif %}
                                </ul>
				</div>
				<!-- /.navbar-header -->
                {% block navbar_secondary %}
				<div class="menu-list">
				     <ul>
					     <li class="active"><a>告警概况</a></li>
					 </ul>
				</div>
                {% endblock navbar_secondary %}

	            <!-- /.navbar-static-side -->
			</nav>
            {%- endblock navbar %}

            {% block page_wrapper -%}
            {% block message %}
            {% with messages = get_flashed_messages() %}
                {% if messages %}
                <div class="col-lg-12">
                    <h2 style="text-align: center">{{ messages }}</h2>
                </div>
                {% endif %}
            {% endwith %}
            {% endblock message %}
            {% block navbar_left %}
            {%- endblock navbar_left %}

			<div id="page-wrapper" class="full-content">
                {% block page_title -%}
				<div class="row page-title">
					<div class="col-lg-12">
						<h1 class="page-header">告警日志概况</h1>
					</div>
					<!-- /.col-lg-12 -->
				</div>
                {%- endblock page_title %}
                {% block row -%}
				<!-- /.row -->
				<div class="row">
					<div class="col-lg-12">
						<div class="panel panel-default panel-mc">
							<!--
							<div class="panel-heading panel-heading-mc">
								Area Chart Example
							</div>
						    -->
							<!-- /.panel-heading -->
							<div class="panel-body panel-body-chart" id="J_exampleChart">
							</div>
							<!-- /.panel-body -->
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-lg-12">
						<!-- /.panel -->
						<div class="panel panel-default panel-mc">
							<div class="panel-heading panel-heading-mc">
								最近4小时遗留告警
							</div>
							<!-- /.panel-heading -->
							<div class="panel-body">
                                <table width="100%" class="table table-striped table-bordered table-hover" id="J_dataTable">
                                    <thead>
                                        <tr>
                                            <th>站点</th>
                                            <th>设备</th>
                                            <th>监控项</th>
                                            <th>状态</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for i in four_hour_stay %}
                                        <tr class="even gradeC">
                                            <td>{{ i.site_id }}</td>
                                            <td>{{ i.info }}</td>
                                            <td>{{ i.type }}</td>
                                            <td>{{ i.status }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
							<!-- /.panel-body -->
						</div>
						<!-- /.panel -->
					</div>
					<!-- /.col-lg-12 -->
				</div>
                <div class="row">
					<div class="col-lg-12">
						<!-- /.panel -->
						<div class="panel panel-default panel-mc">
							<div class="panel-heading panel-heading-mc">
								最近七天告警前十
							</div>
							<!-- /.panel-heading -->
							<div class="panel-body">
                                <table width="100%" class="table table-striped table-bordered table-hover" id="J_dataTable-2">
                                    <thead>
                                        <tr>
                                            <th>站点</th>
                                            <th>设备</th>
                                            <th>监控项</th>
                                            <th>次数</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for i in top_warning_ten %}
                                        <tr class="even gradeC">
                                        <td>{{ i[0] }}</td>
                                        <td>{{ i[1] }}</td>
                                        <td>{{ i[2] }}</td>
                                        <td>{{ i[3] }}</td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
							<!-- /.panel-body -->
						</div>
						<!-- /.panel -->
					</div>
					<!-- /.col-lg-12 -->
				</div>
				<!-- /.row -->
                {%- endblock row %}
			</div>
			<!-- /#page-wrapper -->

            <!--footer -->
			<div class="row reset-row">
				<div class="col-lg-12">
					<div class="footer-info">
						ONEKEEPER 1.0.0 © 2001–2017, MCHZ
					</div>
				</div>
			</div>
			<!-- /.row -->
		    </div>
            {%- endblock page_wrapper %}
		    <!-- /#wrapper -->
        {%- endblock wrapper %}
        {% block scripts -%}
            {% block src -%}
            <!-- jQuery -->
            <script src="{{ url_for('static', filename='src/vendor/jquery/jquery.min.js') }}"></script>

            <!-- Bootstrap Core JavaScript -->
            <script src="{{ url_for('static', filename='src/vendor/bootstrap/js/bootstrap.min.js') }}"></script>

            <!-- DataTables JavaScript -->
            <script src="{{ url_for('static', filename='src/vendor/datatables/js/jquery.dataTables.min.js') }}"></script>
            <script src="{{ url_for('static', filename='src/vendor/datatables-plugins/dataTables.bootstrap.min.js') }}"></script>
            <script src="{{ url_for('static', filename='src/vendor/datatables-responsive/dataTables.responsive.js') }}"></script>

            <!--echarts-->
            <script src="{{ url_for('static', filename='src/vendor/echarts3/echarts.js') }}"></script>


            {%- endblock src %}
            {% block func -%}
                <!-- Page-Level Demo Scripts - Tables - Use for reference -->
                <script>
                    $(document).ready(function() {
                        $('#J_dataTable').DataTable({
                            responsive: true
                        });
                        $('#J_dataTable-2').DataTable({
                            responsive: true
                        });
                    });
                </script>
                <script>
                    function getNowFormatDate() {
                        var date = new Date();
                        var seperator1 = "-";
                        var seperator2 = ":";
                        var month = date.getMonth() + 1;
                        var strDate = date.getDate();
                        if (month >= 1 && month <= 9) {
                            month = "0" + month;
                        }
                        if (strDate >= 0 && strDate <= 9) {
                            strDate = "0" + strDate;
                        }
                        var currentdate = date.getFullYear() + seperator1 + month + seperator1 + strDate
                                + " " + date.getHours() + seperator2 + date.getMinutes()
                                + seperator2 + date.getSeconds();
                        return currentdate
                    }
                </script>
                <script>

                    var chart = echarts.init(document.getElementById('J_exampleChart'));

                    var xAxisData = {{ x_axis_data | safe }};
                    var data1 = {{ data_pb | safe }};
                    var data2 = {{ data_ok | safe }};


            {#        for (var i = 0; i < 24; i++) {#}
            {#            xAxisData.push('Class' + i);#}
            {#            data1.push((Math.random() * 2).toFixed(2));#}
            {#            data2.push(Math.random().toFixed(2));#}
            {#        }#}

                    var itemStyle = {
                        normal: {
                            color: '#6CB8CA'
                        },
                        emphasis: {
                            barBorderWidth: 1,
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowOffsetY: 0,
                            shadowColor: 'rgba(0,0,0,0.5)'
                        }
                    };
                    var itemStyle2 = {
                        normal: {
                            color:'#FAC61D'
                        },
                        emphasis: {
                            barBorderWidth: 1,
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowOffsetY: 0,
                            shadowColor: 'rgba(0,0,0,0.5)'
                        }
                    };

                    option = {
                        legend: {
                            data: ['bar', 'bar2'],
                            align: 'left',
                            left: 10
                        },
                        brush: {
                            toolbox: ['rect', 'polygon', 'lineX', 'lineY', 'keep', 'clear'],
                            xAxisIndex: 0
                        },
                        toolbox: {
                            show:false,//隐藏工具箱
                            feature: {
                                magicType: {
                                    type: ['stack', 'tiled']
                                },
                                dataView: {}
                            }
                        },
                        tooltip: {},
                        xAxis: {
                            data: xAxisData,
                            name: getNowFormatDate(),
                            silent: false,
                            axisLine: {onZero: true},
                            splitLine: {show: false},
                            splitArea: {show: false}
                        },
                        yAxis: {
                            inverse: false,
                            name : '条数',
                            splitArea: {show: false}
                        },
                        grid: {
                            left: 100
                        },
                        // 左侧柱状功能
                        visualMap: {
                            type: 'continuous',
                            dimension: 1,
                            text: ['High', 'Low'],
                            inverse: false,
                            itemHeight: 200,
                            calculable: true,
                            min: 0,
                            max: {{ maxNum }},
                            top: 60,
                            left: 10,
                            inRange: {
                                colorLightness: [0.5, 0.5]
                            },
                            outOfRange: {
                                color: '#bbb'
                            },
                            controller: {
                                inRange: {
                                    color: '#2f4554'
                                }
                            }
                        },
                        series: [
                            {
                                name: 'PROBLEM',
                                type: 'bar',
                                stack: 'one',
                                itemStyle: itemStyle2,
                                data: data1
                            },
                            {
                                name: 'OK',
                                type: 'bar',
                                stack: 'one',
                                itemStyle: itemStyle,
                                data: data2
                            }
                        ]
                    };

                    chart.setOption(option);

                    chart.on('brushSelected', renderBrushed);

                    function renderBrushed(params) {
                        var brushed = [];
                        var brushComponent = params.batch[0];

                        for (var sIdx = 0; sIdx < brushComponent.selected.length; sIdx++) {
                            var rawIndices = brushComponent.selected[sIdx].dataIndex;
                            brushed.push('[Series ' + sIdx + '] ' + rawIndices.join(', '));
                        }

                        chart.setOption({
                            title: {
                                backgroundColor: '#333',
                                text: 'SELECTED DATA INDICES: \n' + brushed.join('\n'),
                                bottom: 0,
                                right: 0,
                                width: 100,
                                textStyle: {
                                    fontSize: 12,
                                    color: '#fff'
                                }
                            }
                        });
                    }
    </script>
            {%- endblock func %}
        {%- endblock scripts %}
    {%- endblock body %}
</body>
{%- endblock html %}
</html>
{% endblock doc -%}




